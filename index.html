<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì∫ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ü‡¶ø‡¶≠‡¶ø ‡¶™‡ßç‡¶≤‡ßá‡¶Ø‡¶º‡¶æ‡¶∞</title>
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script> 
    <script src="https://cdn.jsdelivr.net/npm/dashjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/all-in-one-player@latest/dist/all-in-one.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #282a47;
            --text-color: #f0f0f0;
            --accent-color: #f99d1c;
            --shadow-color: rgba(0, 0, 0, 0.4);
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .content {
            padding: 20px;
            flex-grow: 1;
            max-width: 1400px;
            margin: 20px auto;
            display: flex;
            gap: 20px;
            background-color: #212135;
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow-color);
        }
        
        .player-section {
            flex-basis: 70%;
            background-color: #000;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        #videoPlayer {
            width: 100%;
            aspect-ratio: 16 / 9; 
            background-color: #000;
        }
        
        .channel-sidebar {
            flex-basis: 30%;
            max-height: 80vh; 
            overflow-y: auto;
            padding: 10px;
            background-color: var(--card-bg);
            border-radius: 10px;
        }
        
        .channel-sidebar::-webkit-scrollbar { width: 8px; }
        .channel-sidebar::-webkit-scrollbar-thumb { background-color: var(--accent-color); border-radius: 4px; }
        
        .channel-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .channel-card {
            background-color: #383a60;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px var(--shadow-color);
            transition: transform 0.2s ease, outline 0.2s ease;
            cursor: pointer;
            outline: 3px solid transparent;
            display: flex;
            align-items: center;
        }
        
        .channel-card:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 12px var(--shadow-color);
        }
        
        .channel-card.selected {
            transform: scale(1.02);
            outline: 3px solid var(--accent-color);
            box-shadow: 0 0 10px var(--accent-color);
            background-color: #444670;
        }
        
        .channel-card img {
            width: 40px; 
            height: 40px;
            object-fit: contain;
            border-radius: 6px;
            margin-right: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: #fff;
        }
        
        .channel-card h3 {
            margin: 0;
            font-size: 0.9em;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #statusMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #f0f0f0;
            text-align: center;
            padding: 15px 25px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            font-weight: 600;
            z-index: 10;
        }

        @media (max-width: 900px) {
            .content {
                flex-direction: column;
            }
            .player-section, .channel-sidebar {
                flex-basis: 100%;
                max-height: 40vh;
            }
        }
    </style>
</head>
<body>

    <div class="content">
        <div class="player-section">
            <video id="videoPlayer" controls autoplay></video>
            <div id="statusMessage" style="display: block;">‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </div>

        <div class="channel-sidebar" id="app-content">
            <h2 style="text-align: center; color: var(--accent-color);">‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
            <div class="channel-grid" id="channel-grid">
                </div>
        </div>
    </div>

    <script>
        // *** ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ***
        const firebaseConfig = {
          apiKey: "AIzaSyBcDC4UMsTgo2IAXUxmTF2UqpvgfRWOwas",
          authDomain: "live-tv-9521d.firebaseapp.com",
          databaseURL: "https://live-tv-9521d-default-rtdb.firebaseio.com",
          projectId: "live-tv-9521d",
          storageBucket: "live-tv-9521d.firebasestorage.app",
          messagingSenderId: "475229762007",
          appId: "1:475229762007:web:9a42815a3bd43acabf5b92",
          measurementId: "G-RH9L4JG4WT"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const channelsRef = database.ref('channels');

        const video = document.getElementById('videoPlayer');
        const channelGrid = document.getElementById('channel-grid');
        const statusMessage = document.getElementById('statusMessage');
        let currentItems = [];
        let selectedItemIndex = 0;
        
        // --- ‡¶™‡ßç‡¶≤‡ßá‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function resetPlayer() {
            video.removeAttribute('src'); 
            video.load(); 
            video.style.display = 'block';
            statusMessage.style.display = 'block';
            statusMessage.textContent = '‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
        }

        window.playM3U8 = function(url, clickedCard) {
            document.querySelectorAll('.channel-card').forEach(card => card.classList.remove('selected'));
            if (clickedCard) {
                clickedCard.classList.add('selected');
            }

            resetPlayer();
            
            // `all-in-one-player` ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶≤‡ßá‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï
            const player = new AllInOnePlayer(video, {
                src: url,
                autoplay: true,
                poster: 'https://via.placeholder.com/1280x720.png?text=Loading...',
                controls: true,
            });

            player.on('error', (error) => {
                video.style.display = 'none';
                let errorMessage = '‚ùå **‡¶™‡ßç‡¶≤‡ßá‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§** ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨‡¶§: ';
                if (error.type === 'network') {
                    errorMessage += '‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø Hotlink ‡¶¨‡¶æ CORS ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§';
                } else if (error.type === 'fatal') {
                    errorMessage += '‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶â‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£ ‡¶¨‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡•§';
                } else {
                    errorMessage += '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§';
                }
                statusMessage.innerHTML = errorMessage;
                statusMessage.style.display = 'block';
            });

            player.on('loadedmetadata', () => {
                statusMessage.style.display = 'none';
            });
        }
        
        // --- ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶è‡¶¨‡¶Ç ‡¶á‡¶â‡¶Ü‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---

        function loadChannels(dbPath) {
            channelsRef.once('value', (snapshot) => {
                const channels = snapshot.val() || {};
                channelGrid.innerHTML = '';
                currentItems = [];

                let firstChannelUrl = null;
                let firstCard = null;

                for (let key in channels) {
                    const channel = channels[key];
                    const div = document.createElement('div');
                    div.className = 'channel-card';
                    
                    const imageUrl = channel.image && channel.image.startsWith('http') ? channel.image : 'https://via.placeholder.com/40x40.png?text=TV';

                    div.innerHTML = `<img src="${imageUrl}" alt="${channel.name}"><h3>${channel.name}</h3>`;
                    
                    div.onclick = function() {
                        playM3U8(channel.url, this);
                        this.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
                    };
                    
                    channelGrid.appendChild(div);
                    currentItems.push(div);
                    
                    if (!firstChannelUrl) {
                        firstChannelUrl = channel.url;
                        firstCard = div;
                    }
                }
                
                if (firstChannelUrl) {
                    playM3U8(firstChannelUrl, firstCard);
                }
            });
        }
        
        // --- ‡¶ï‡ßÄ-‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ---

        function navigate(direction) {
            const currentSelected = document.querySelector('.selected');
            if (currentSelected) {
                currentSelected.classList.remove('selected');
            }
            if (currentItems.length === 0) return;

            const numCols = 1; 

            if (direction === 'ArrowUp') {
                selectedItemIndex = (selectedItemIndex - 1 + currentItems.length) % currentItems.length;
            } else if (direction === 'ArrowDown') {
                selectedItemIndex = (selectedItemIndex + 1) % currentItems.length;
            } else if (direction === 'ArrowLeft' || direction === 'ArrowRight') {
                return;
            }
            
            currentItems[selectedItemIndex].classList.add('selected');
            currentItems[selectedItemIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        document.addEventListener('keydown', (e) => {
            const validKeys = ['ArrowUp', 'ArrowDown', 'Enter'];
            if (!validKeys.includes(e.key)) return;
            
            if (e.key === 'Enter' && currentItems.length > 0) {
                currentItems[selectedItemIndex].click();
            } else {
                navigate(e.key);
            }
        });

        loadChannels('channels');
    </script>
</body>
</html>
